# Протокол связи DLMS/COSEM

> _Внимание! Статья в стадии написания._

### Конфигурация станций

Адрес станции (HDLC/MAC-адрес сервера DLMS) состоит из двух частей: нижнего MAC-адреса и верхнего MAC-адреса. Каждый из которых находится в диапазоне значений от 0 до 16383 (3FFFH).

`Lower MAC-address` (нижний MAC-адрес) - используется для адресации физического устройства в вычислительной сети.

`Upper MAC-address` (верхний MAC-адрес) - используется для адресации логического устройства, находящегося в составе физического устройства.

> Верхний MAC-адрес равный 1 определяет логическое устройство управления (Management Logical Device).

Если необходимо выяснить сколько логических устройств содержится в физическом устройстве, то необходимо просмотреть регистр "0-0:41.0.0" класса "SAP assignment" (class_id=17, attribute 2 "SAP_assignment_list").

> HDLC/MAC-адрессация используется только при использовании протоколов обмена "Прямой HDLC" или "Режим E IEC".

...

...

...

[...в процессе редактуры и дополнения...]

...

...

...

## Адресация тегов ввода-ввывода

Адрессация объектов в протоколе DLMS/COSEM описана в стандарте IEC 62056-61 "Система идентификации объектов (OBIS)", глава "Приложение А  - представление кода."

Используя ссылку на логическое имя (LN, Logical Name) обращение к объектам модели COSEM выполняется с помощью OBIS-адреса.

Используя ссылку на короткое имя (SN, Short Name) обращение к объектам модели COSEM выполняется с помощью 16-разрядного цифрового адреса.

Объекты данных в модели приложения COSEM являются экземлярами интерфейсных классов COSEM (IC COSEM).

Типы интерфейсных классов COSEM указаны в документе "Система идентификации COSEM и классы интерфейса" (Синяя книга DLMS/COSEM).

Каждый тип интерфейсного класса COSEM имеет свой собственный идентификационный номер ("class_id"). У каждого интерфейсного класса есть набор атрибутов с порядковыми номерами. Атрибут облегчает считывание определенного параметра объекта данных.

Каждый экземпляр класса имеет свой начальный SN-адрес (base_name), который также является адресом первого атрибута интерфейсного класса.
Логическое base_name является первым атрибутом всех классов COSEM.
Считывая этот атрибут, можно получить OBIS-адрес объекта данных, который представлен определенным интерфесным классом. Адреса других атрибутов вычисляются в соответствии со следующей формулой в режиме адрессации по короткому имени "Short Name":

short_name = base_name + ((attribute_index - 1) * 0x08)

Атрибуты могут быть статическими или динамическими в зависимости от того, являются ли их значения статическими (неизменными, установленными производителем или в конфигурации устройства) или динамическими (изменяющимися). 

## Интерфесные классы модели COSEM

<table>
    <tr>
        <td colspan=4>
            <kbd>Data</kbd>
            <kbd>(class_id = 1, version = 0)</kbd>
        </td>
    </tr>
    <tr>
        <td colspan=2>Атрибут</td>
        <td>Тип атрибута</td>
        <td>Описание атрибута</td>
    </tr>
    <tr>
        <td>1</td>
        <td>logical_name (static)</td>
        <td>octet-string (text)</td>
        <td>OBIS - адрес объекта данных, который представлен экземпляром этого класса.</td>
    </tr>
    <tr>
        <td>2</td>
        <td>value (dynamic)</td>
        <td>CHOICE*</td>
        <td>Значение объекта данных</td>
    </tr>
<table>

*см. [Типы атрибутов класса](#attrib_types)

## Специфика адрессации OBIS

Адрессация объектов в модели приложения COSEM описана в международном стандарте IEC 62056-21 и состоит из 6 групп:

<table>
    <tr>
        <td><kbd>A</kbd></td>
        <td><kbd>B</kbd></td>
        <td><kbd>C</kbd></td>
        <td><kbd>D</kbd></td>
        <td><kbd>E</kbd></td>
        <td><kbd>F</kbd></td>
    </tr>
</table>

<table>
    <tr>
        <td>Группа</td>
        <td>Значение группы</td>
    </tr>
    <tr>
        <td>
            <kbd>A</kbd>
        </td>
        <td>
            значение группы А определяет тип энергии (0=абстрактные объекты, 1=электричество, 7=газ).,
        </td>
    </tr>
    <tr>
        <td>
            <kbd>B</kbd>
        </td>
        <td>
            значение группы B определяет номер канала (?измерения)
        </td>
    </tr>
    <tr>
        <td>
            <kbd>C</kbd>
        </td>
        <td>
            значение группы C определяет измеряемую физическую величину
        </td>
    </tr>
    <tr>
        <td>
            <kbd>D</kbd>
        </td>
        <td>
            значение группы D определяет тип обработки
        </td>
    </tr>
    <tr>
        <td>
            <kbd>E</kbd>
        </td>
        <td>
            значение группы E определяет дальнейшую обработку или классификацию в соответствии с алгоритмом
        </td>
    </tr>
    <tr>
        <td>
            <kbd>F</kbd>
        </td>
        <td>
            значение группы F определяет порядок хранения обработанных исторических данных
        </td>
    </tr>
</table>

Значения групп от A до F представляет собой положительное число в диапазоне от 0 до 255.

Для групп значений C и D вы также можете ввести значения символов:
- символ 'C' является значением 96,
- символ 'F' является значением 97,
- символ 'L' является значением 98,
- символ 'P' является значением 99.

OBIS-адрес объекта в модели COSEM указывается в следующем токстовом формате:

<kbd>A-B:C.D.E*F</kbd>

Группы <kbd>C</kbd>, <kbd>D</kbd> и <kbd>E</kbd> всегда должны содержать значений из допустимого диапазона. Оставшиеся группы <kbd>A</kbd>, <kbd>B</kbd> и <kbd>F</kbd> могут быть не указаны, в этом случае их значения будут равны нулю (0).

> Для получения более дополнительной информации обратитесь к руководству по эксплуатации используемого оборудования или к списку стандартных OBIS-кодов и объектов COSEM ("List of standardized OBIS codes, DLMS UA).

Примеры OBIS-адресов объектов в модели COSEM:
|OBIS-адрес |Описание адресуемого объекта|
|-|-|
|1.8.0| Принятая из сети активная энергия (A+) [kWh]|
|2.8.0| Сгенерированная в сеть активная энергия (А-) [kWh]|
|15.8.0| Абсолютная активная энергия ( \| А \| ) [kWh] 
|...|...|

## <a id="title1">Типы атрибутов класса</a>

<table>
    <tr>
        <td>Тип атрибута</td>
        <td>Описание типа</td>
    </tr>
    <tr>
        <td>null-data</td>
        <td>no data</td>
    </tr>
    <tr>
        <td>boolean</td>
        <td>boolean (true/false)</td>
    </tr>
    <tr>
        <td>bit-string</td>
        <td>unsupported</td>
    </tr>
    <tr>
        <td>double-long</td>
        <td>32-bit signed number</td>
    </tr>
    <tr>
        <td>double-long-unsigned</td>
        <td>32-bit unsigned number</td>
    </tr>
    <tr>
        <td>octet-string</td>
        <td>string of bytes</td>
    </tr>
    <tr>
        <td>visible-string</td>
        <td>string (text)</td>
    </tr>
    <tr>
        <td>UTF8-string</td>
        <td>UTF8 string (text)</td>
    </tr>
    <tr>
        <td>bcd</td>
        <td>unsupported</td>
    </tr>
    <tr>
        <td>integer</td>
        <td>8-bit signed number</td>
    </tr>
    <tr>
        <td>long</td>
        <td>16-bit signed number</td>
    </tr>
    <tr>
        <td>unsigned</td>
        <td>8-bit unsigned number</td>
    </tr>
    <tr>
        <td>long-unsigned</td>
        <td>16-bit unsigned number</td>
    </tr>
    <tr>
        <td>long64</td>
        <td>64-bit signed number</td>
    </tr>
    <tr>
        <td>long64-unsigned</td>
        <td>64-bit unsigned number</td>
    </tr>
    <tr>
        <td>enum</td>
        <td>enumerated type</td>
    </tr>
    <tr>
        <td>float32</td>
        <td>32-bit float</td>
    </tr>
    <tr>
        <td>float64</td>
        <td>64-bit float</td>
    </tr>
    <tr>
        <td>date-time</td>
        <td>date + time</td>
    </tr>
    <tr>
        <td>date</td>
        <td>date</td>
    </tr>
    <tr>
        <td>time</td>
        <td>time</td>
    </tr>
</table>